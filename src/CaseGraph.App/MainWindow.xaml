<ui:FluentWindow x:Class="CaseGraph.App.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 mc:Ignorable="d"
                 Title="CaseGraph Offline"
                 Width="1400"
                 Height="860"
                 MinWidth="1100"
                 MinHeight="700"
                 WindowStartupLocation="CenterScreen"
                 Loaded="OnLoaded"
                 ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
                 ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}">
    <Grid Background="{DynamicResource ShellBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource TopBarBorderStyle}">
            <DockPanel LastChildFill="False">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="CaseGraph Offline" Style="{StaticResource AppTitleTextStyle}" />
                    <TextBlock Text="Case workspace + evidence vault baseline" Style="{StaticResource AppSubtitleTextStyle}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBox Width="260"
                             Margin="{StaticResource SpaceRight12}"
                             Text="{Binding GlobalSearchQuery, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource TopBarTextBoxStyle}"
                             ToolTip="Global search placeholder" />

                    <ComboBox Width="240"
                              Margin="{StaticResource SpaceRight12}"
                              ItemsSource="{Binding AvailableCases}"
                              SelectedItem="{Binding SelectedCase, Mode=TwoWay}"
                              DisplayMemberPath="Name"
                              Style="{StaticResource TopBarComboBoxStyle}" />

                    <Button Content="Open Case"
                            Margin="{StaticResource SpaceRight12}"
                            Command="{Binding OpenSelectedCaseCommand}"
                            Style="{StaticResource TopBarButtonStyle}" />

                    <Button Content="Toggle Theme"
                            Margin="{StaticResource SpaceRight12}"
                            Command="{Binding ToggleThemeCommand}"
                            Style="{StaticResource TopBarButtonStyle}" />

                    <Button Content="Evidence Drawer"
                            Command="{Binding ToggleEvidenceDrawerCommand}"
                            Style="{StaticResource TopBarButtonStyle}" />
                </StackPanel>
            </DockPanel>
        </Border>

        <Grid Grid.Row="1" Margin="{StaticResource Space16}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="340" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource NavigationPanelBorderStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Navigation" Style="{StaticResource SectionTitleTextStyle}" />

                    <ListBox Grid.Row="1"
                             Margin="{StaticResource SpaceTop12}"
                             ItemsSource="{Binding NavigationItems}"
                             SelectedItem="{Binding SelectedNavigationItem, Mode=TwoWay}"
                             BorderThickness="0"
                             Background="Transparent"
                             ItemContainerStyle="{StaticResource NavigationListItemStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}" Style="{StaticResource NavigationItemTitleTextStyle}" />
                                    <TextBlock Text="{Binding Description}" Style="{StaticResource NavigationItemDescriptionTextStyle}" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <Border Grid.Column="2" Style="{StaticResource ContentPanelBorderStyle}">
                <ContentControl Content="{Binding CurrentView}" />
            </Border>

            <Border Grid.Column="4"
                    Style="{StaticResource EvidenceDrawerBorderStyle}"
                    Visibility="{Binding IsEvidenceDrawerOpen, Converter={StaticResource BoolToVisibilityConverter}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Evidence Drawer" Style="{StaticResource SectionTitleTextStyle}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.DisplayName, TargetNullValue=No evidence selected}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="EvidenceItemId" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.EvidenceItemId, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="SourceType" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.SourceType, TargetNullValue=(none)}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="AddedAtUtc" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.AddedAtUtc, StringFormat={}{0:u}, TargetNullValue=(none)}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="SizeBytes" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.SizeBytes, TargetNullValue=(none)}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Sha256Hex" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.Sha256Hex, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="StoredRelativePath" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.StoredRelativePath, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="ManifestRelativePath" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.ManifestRelativePath, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="OriginalPath" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceItem.OriginalPath, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <Button Margin="{StaticResource SpaceTop16}"
                                Content="Copy Stored Path"
                                IsEnabled="{Binding HasSelectedEvidenceItem}"
                                Command="{Binding CopyStoredPathCommand}"
                                Style="{StaticResource TopBarButtonStyle}" />

                        <Button Margin="{StaticResource SpaceTop12}"
                                Content="Copy SHA-256"
                                IsEnabled="{Binding HasSelectedEvidenceItem}"
                                Command="{Binding CopySha256Command}"
                                Style="{StaticResource TopBarButtonStyle}" />

                        <Button Margin="{StaticResource SpaceTop12}"
                                Content="Verify Integrity"
                                IsEnabled="{Binding HasSelectedEvidenceItem}"
                                Command="{Binding VerifySelectedEvidenceCommand}"
                                Style="{StaticResource TopBarButtonStyle}" />

                        <Button Margin="{StaticResource SpaceTop12}"
                                Content="Parse Messages"
                                IsEnabled="{Binding HasSelectedEvidenceItem}"
                                Command="{Binding ParseMessagesFromEvidenceCommand}"
                                Style="{StaticResource TopBarButtonStyle}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Latest Verify Job" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceVerifyStatus}"
                                   TextWrapping="Wrap" />

                        <DockPanel Margin="{StaticResource SpaceTop12}">
                            <TextBlock DockPanel.Dock="Left"
                                       Style="{StaticResource SecondaryBodyTextStyle}"
                                       VerticalAlignment="Center"
                                       Text="Latest Messages Parse Job" />
                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                <Button Margin="0,0,8,0"
                                        MinHeight="28"
                                        Padding="10,0"
                                        Content="Refresh"
                                        Command="{Binding RefreshLatestMessagesParseJobCommand}"
                                        Style="{StaticResource TopBarButtonStyle}" />
                                <Button MinHeight="28"
                                        Padding="10,0"
                                        Content="Cancel Parse Job"
                                        Command="{Binding CancelLatestMessagesParseJobCommand}"
                                        IsEnabled="{Binding CanCancelLatestMessagesParseJob}"
                                        Visibility="{Binding CanCancelLatestMessagesParseJob, Converter={StaticResource BoolToVisibilityConverter}}"
                                        Style="{StaticResource TopBarButtonStyle}" />
                            </StackPanel>
                        </DockPanel>

                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedEvidenceMessagesStatus}"
                                   TextWrapping="Wrap" />
                        <TextBlock Margin="{StaticResource SpaceTop8}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="{Binding LatestMessagesParseJob.Progress, StringFormat=Progress {0:P0}, TargetNullValue=Progress (none)}" />
                        <TextBlock Margin="{StaticResource SpaceTop8}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="{Binding LatestMessagesParseJob.StartedAtUtc, StringFormat=Started {0:u}, TargetNullValue=Started (none)}" />
                        <TextBlock Margin="{StaticResource SpaceTop8}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="{Binding LatestMessagesParseJob.CompletedAtUtc, StringFormat=Completed {0:u}, TargetNullValue=Completed (none)}" />
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</ui:FluentWindow>
