<UserControl x:Class="CaseGraph.App.Views.Pages.TimelineView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{DynamicResource ContentBackgroundBrush}">
    <Grid Margin="{StaticResource Space16}"
          DataContext="{Binding Timeline}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" LastChildFill="False">
            <StackPanel DockPanel.Dock="Left">
                <TextBlock Text="Timeline" Style="{StaticResource PageTitleTextStyle}" />
                <TextBlock Margin="{StaticResource SpaceTop8}"
                           Style="{StaticResource SecondaryBodyTextStyle}"
                           Text="{Binding StatusText}" />
            </StackPanel>

            <StackPanel DockPanel.Dock="Right"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <TextBlock VerticalAlignment="Center"
                           Style="{StaticResource SecondaryBodyTextStyle}"
                           Text="{Binding PageSummaryText}" />
                <Button Margin="{StaticResource SpaceLeft8}"
                        Content="Previous"
                        Command="{Binding PreviousPageCommand}"
                        Style="{StaticResource TopBarButtonStyle}" />
                <Button Margin="{StaticResource SpaceLeft8}"
                        Content="Next"
                        Command="{Binding NextPageCommand}"
                        Style="{StaticResource TopBarButtonStyle}" />
            </StackPanel>
        </DockPanel>

        <Border Grid.Row="1"
                Margin="{StaticResource SpaceTop12}"
                Style="{StaticResource PlaceholderHintBorderStyle}">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1.4*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="1.2*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="1.2*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Text="{Binding QueryText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource TopBarTextBoxStyle}"
                             ToolTip="Text contains filter (body/sender/recipients)" />

                    <ComboBox Grid.Column="2"
                              ItemsSource="{Binding TargetFilters}"
                              SelectedItem="{Binding SelectedTargetFilter, Mode=TwoWay}"
                              DisplayMemberPath="DisplayName"
                              Style="{StaticResource TopBarComboBoxStyle}"
                              ToolTip="Target filter" />

                    <ComboBox Grid.Column="4"
                              ItemsSource="{Binding GlobalPersonFilters}"
                              SelectedItem="{Binding SelectedGlobalPersonFilter, Mode=TwoWay}"
                              DisplayMemberPath="DisplayName"
                              Style="{StaticResource TopBarComboBoxStyle}"
                              ToolTip="Global person filter" />

                    <ComboBox Grid.Column="6"
                              ItemsSource="{Binding DirectionFilters}"
                              SelectedItem="{Binding SelectedDirection, Mode=TwoWay}"
                              Style="{StaticResource TopBarComboBoxStyle}"
                              ToolTip="Direction filter" />

                    <DatePicker Grid.Column="8"
                                SelectedDate="{Binding FromDateLocal, Mode=TwoWay}"
                                ToolTip="From date (local)" />

                    <DatePicker Grid.Column="10"
                                SelectedDate="{Binding ToDateLocal, Mode=TwoWay}"
                                ToolTip="To date (local)" />

                    <Button Grid.Column="12"
                            Content="Search"
                            Command="{Binding SearchCommand}"
                            Style="{StaticResource TopBarButtonStyle}" />
                </Grid>

                <WrapPanel Margin="{StaticResource SpaceTop8}">
                    <Button Content="Clear Filters"
                            Command="{Binding ClearFiltersCommand}"
                            Style="{StaticResource TopBarButtonStyle}" />

                    <TextBlock Margin="{StaticResource SpaceLeft12}"
                               VerticalAlignment="Center"
                               Style="{StaticResource SecondaryBodyTextStyle}"
                               Text="{Binding IsLoading, StringFormat=Loading: {0}}" />
                </WrapPanel>
            </StackPanel>
        </Border>

        <Grid Grid.Row="2" Margin="{StaticResource SpaceTop12}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2.1*" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <DataGrid Grid.Column="0"
                      ItemsSource="{Binding Rows}"
                      SelectedItem="{Binding SelectedRow, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      ScrollViewer.CanContentScroll="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Time (Local)"
                                        Binding="{Binding TimestampLocalDisplay}"
                                        Width="1.2*" />
                    <DataGridTextColumn Header="Type"
                                        Binding="{Binding EventType}"
                                        Width="0.8*" />
                    <DataGridTextColumn Header="Direction"
                                        Binding="{Binding Direction}"
                                        Width="0.9*" />
                    <DataGridTextColumn Header="Participants"
                                        Binding="{Binding ParticipantsSummary}"
                                        Width="1.8*" />
                    <DataGridTextColumn Header="Preview"
                                        Binding="{Binding Preview}"
                                        Width="2.6*" />
                    <DataGridTemplateColumn Header="Source" Width="1.1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="View Source"
                                        Command="{Binding DataContext.ViewSourceCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource TopBarButtonStyle}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Citation" Width="1.1*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Copy Citation"
                                        Command="{Binding DataContext.CopyCitationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource TopBarButtonStyle}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <Border Grid.Column="2" Style="{StaticResource PlaceholderHintBorderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Selected Timeline Event" Style="{StaticResource SectionTitleTextStyle}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Timestamp (Local)" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedRow.TimestampLocalDisplay, TargetNullValue=(none)}" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Evidence" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedRow.EvidenceDisplayName, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Source Locator" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedRow.SourceLocator, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Participants" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedRow.ParticipantsSummary, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Preview" />
                        <TextBlock Style="{StaticResource BodyTextStyle}"
                                   Text="{Binding SelectedRow.Preview, TargetNullValue=(none)}"
                                   TextWrapping="Wrap" />

                        <TextBlock Margin="{StaticResource SpaceTop12}"
                                   Style="{StaticResource SecondaryBodyTextStyle}"
                                   Text="Body" />
                        <TextBox Text="{Binding SelectedRow.Body, TargetNullValue=(none)}"
                                 IsReadOnly="True"
                                 MinHeight="180"
                                 VerticalScrollBarVisibility="Auto"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 Style="{StaticResource TopBarTextBoxStyle}" />

                        <WrapPanel Margin="{StaticResource SpaceTop16}">
                            <Button Content="View Source"
                                    Command="{Binding ViewSourceCommand}"
                                    CommandParameter="{Binding SelectedRow}"
                                    Style="{StaticResource TopBarButtonStyle}" />
                            <Button Margin="{StaticResource SpaceLeft8}"
                                    Content="Copy Citation"
                                    Command="{Binding CopyCitationCommand}"
                                    CommandParameter="{Binding SelectedRow}"
                                    Style="{StaticResource TopBarButtonStyle}" />
                        </WrapPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>
