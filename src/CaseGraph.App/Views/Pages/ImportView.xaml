<UserControl x:Class="CaseGraph.App.Views.Pages.ImportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:CaseGraph.App.Converters"
             Background="{DynamicResource ContentBackgroundBrush}">
    <UserControl.Resources>
        <converters:Sha256ShortConverter x:Key="Sha256ShortConverter" />
    </UserControl.Resources>

    <Grid Margin="{StaticResource Space16}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="170" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Evidence Import" Style="{StaticResource PageTitleTextStyle}" />

        <Border Grid.Row="1"
                Margin="{StaticResource SpaceTop12}"
                Style="{StaticResource PlaceholderHintBorderStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Content="New Case"
                        Command="{Binding CreateNewCaseCommand}"
                        Style="{StaticResource TopBarButtonStyle}" />

                <ComboBox Grid.Column="2"
                          ItemsSource="{Binding AvailableCases}"
                          SelectedItem="{Binding SelectedCase, Mode=TwoWay}"
                          DisplayMemberPath="Name"
                          ToolTip="Open existing case"
                          Style="{StaticResource TopBarComboBoxStyle}" />

                <Button Grid.Column="3"
                        Margin="{StaticResource SpaceRight12}"
                        Content="Open Case"
                        Command="{Binding OpenSelectedCaseCommand}"
                        ToolTip="{Binding OpenCaseAvailabilityText}"
                        Style="{StaticResource TopBarButtonStyle}" />

                <Button Grid.Column="4"
                        Content="Refresh"
                        Command="{Binding RefreshCasesCommand}"
                        Style="{StaticResource TopBarButtonStyle}" />

                <TextBlock Grid.Column="5"
                           Margin="16,8,0,0"
                           Style="{StaticResource SecondaryBodyTextStyle}"
                           Text="{Binding CurrentCaseSummary}" />
            </Grid>
        </Border>

        <StackPanel Grid.Row="2"
                    Margin="{StaticResource SpaceTop12}"
                    Orientation="Horizontal">
            <Button Content="Import Files..."
                    Command="{Binding ImportFilesCommand}"
                    Style="{StaticResource TopBarButtonStyle}" />
        </StackPanel>

        <DataGrid Grid.Row="3"
                  Margin="{StaticResource SpaceTop12}"
                  ItemsSource="{Binding EvidenceItems}"
                  SelectedItem="{Binding SelectedEvidenceItem, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  IsReadOnly="True"
                  HeadersVisibility="Column">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="2*" />
                <DataGridTextColumn Header="Source Type" Binding="{Binding SourceType}" Width="*" />
                <DataGridTextColumn Header="Added" Binding="{Binding AddedAtUtc, StringFormat={}{0:u}}" Width="1.6*" />
                <DataGridTextColumn Header="SizeBytes" Binding="{Binding SizeBytes}" Width="*" />
                <DataGridTemplateColumn Header="SHA-256 (short)" Width="1.3*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Sha256Hex, Converter={StaticResource Sha256ShortConverter}}"
                                       ToolTip="{Binding Sha256Hex}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Original File" Binding="{Binding OriginalFileName}" Width="2*" />
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="4"
                Margin="{StaticResource SpaceTop12}"
                Style="{StaticResource PlaceholderHintBorderStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Text="Recent Activity (last 20)"
                           Style="{StaticResource SectionTitleTextStyle}" />

                <ListBox Grid.Row="1"
                         Margin="{StaticResource SpaceTop12}"
                         ItemsSource="{Binding RecentAuditEvents}"
                         BorderThickness="0"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,0,0,8">
                                <TextBlock Style="{StaticResource NavigationItemTitleTextStyle}"
                                           Text="{Binding Summary}" />
                                <TextBlock Style="{StaticResource SecondaryBodyTextStyle}"
                                           Text="{Binding TimestampUtc, StringFormat={}{0:u}}" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <Border Grid.Row="5"
                Margin="{StaticResource SpaceTop12}"
                Style="{StaticResource TopBarBorderStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="56" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock VerticalAlignment="Center"
                           Style="{StaticResource SecondaryBodyTextStyle}"
                           Text="{Binding OperationText}" />

                <ProgressBar Grid.Column="1"
                             Height="18"
                             Margin="{StaticResource SpaceRight12}"
                             VerticalAlignment="Center"
                             Minimum="0"
                             Maximum="1"
                             Value="{Binding OperationProgress}" />

                <TextBlock Grid.Column="2"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Style="{StaticResource SecondaryBodyTextStyle}"
                           Text="{Binding OperationProgressPercentText}" />

                <Button Grid.Column="4"
                        Content="Cancel"
                        IsEnabled="{Binding IsOperationInProgress}"
                        Command="{Binding CancelOperationCommand}"
                        Style="{StaticResource TopBarButtonStyle}" />
            </Grid>
        </Border>
    </Grid>
</UserControl>
